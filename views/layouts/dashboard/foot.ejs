</div>
<!-- END wrapper -->



<script>
    var resizefunc = [];
</script>

<!-- jQuery  -->
<script src="/admin_assets/js/jquery.min.js"></script>
<script src="/admin_assets/js/bootstrap.min.js"></script>
<script src="/admin_assets/js/detect.js"></script>
<script src="/admin_assets/js/fastclick.js"></script>
<script src="/admin_assets/js/jquery.blockUI.js"></script>
<script src="/admin_assets/js/waves.js"></script>
<script src="/admin_assets/js/jquery.nicescroll.js"></script>
<script src="/admin_assets/js/jquery.slimscroll.js"></script>
<script src="/admin_assets/js/jquery.scrollTo.min.js"></script>

<!-- KNOB JS -->
<!--[if IE]>
<script type="text/javascript" src="/admin_assets/plugins/jquery-knob/excanvas.js"></script>
<![endif]-->
<script src="/admin_assets/plugins/jquery-knob/jquery.knob.js"></script>

<!--Morris Chart-->
<!-- <script src="/admin_assets/plugins/morris/morris.min.js"></script>
<script src="/admin_assets/plugins/raphael/raphael-min.js"></script> -->

<!-- Dashboard init -->
<!-- <script src="/admin_assets/pages/jquery.dashboard.js"></script> -->
       <!-- Datatables-->
       <script src="/admin_assets/plugins/datatables/jquery.dataTables.min.js"></script>
       <script src="/admin_assets/plugins/datatables/dataTables.bootstrap.js"></script>
       <script src="/admin_assets/plugins/datatables/dataTables.buttons.min.js"></script>
       <script src="/admin_assets/plugins/datatables/buttons.bootstrap.min.js"></script>
       <script src="/admin_assets/plugins/datatables/jszip.min.js"></script>
       <script src="/admin_assets/plugins/datatables/pdfmake.min.js"></script>
       <script src="/admin_assets/plugins/datatables/vfs_fonts.js"></script>
       <script src="/admin_assets/plugins/datatables/buttons.html5.min.js"></script>
       <script src="/admin_assets/plugins/datatables/buttons.print.min.js"></script>
       <script src="/admin_assets/plugins/datatables/dataTables.fixedHeader.min.js"></script>
       <script src="/admin_assets/plugins/datatables/dataTables.keyTable.min.js"></script>
       <script src="/admin_assets/plugins/datatables/dataTables.responsive.min.js"></script>
       <script src="/admin_assets/plugins/datatables/responsive.bootstrap.min.js"></script>
       <script src="/admin_assets/plugins/datatables/dataTables.scroller.min.js"></script>
       <script src="/admin_assets/js/socket.io.js"></script>
       <script src="/admin_assets/js/socket-client-side.js"></script>

       <script src="/admin_assets/plugins/switchery/switchery.min.js"></script>

       <!-- Modal-Effect -->
       <script src="/admin_assets/plugins/custombox/dist/custombox.min.js"></script>
       <script src="/admin_assets/plugins/custombox/dist/legacy.min.js"></script>


       <!-- Datatable init js -->
       <script src="/admin_assets/pages/datatables.init.js"></script>

       
       <script type="text/javascript">
        $(document).ready(function() {
            $('#datatable').dataTable();
            $('#datatable-keytable').DataTable( { keys: true } );
            $('#datatable-responsive').DataTable();
            $('#datatable-scroller').DataTable( { ajax: "/admin_assets/plugins/datatables/json/scroller-demo.json", deferRender: true, scrollY: 380, scrollCollapse: true, scroller: true } );
            var table = $('#datatable-fixed-header').DataTable( { fixedHeader: true } );
            
        } );
        TableManageButtons.init();

    </script>
          <!-- file uploads js -->
        <script src="/admin_assets/plugins/fileuploads/js/dropify.min.js"></script>
        <script type="text/javascript">
        var pageTitle = '<%= title %>';
            $('.dropify').dropify({
                messages: {
                    'default': 'Drag and drop a your '+((pageTitle == 'Add-product')? 'feature image' : pageTitle)+' image here or click',
                    'replace': 'Drag and drop or click to replace',
                    'remove': 'Remove',
                    'error': 'Ooops, something wrong appended.'
                },
                error: {
                    'fileSize': 'The file size is too big (1M max).'
                }
            });
        </script>
<!-- App js -->
<script src="/admin_assets/js/jquery.core.js"></script>
<script src="/admin_assets/js/jquery.app.js"></script>



<script src="/admin_assets/js/custom.js"></script>

 <script src="/admin_assets/plugins/jquery-ui/jquery-ui.min.js"></script>

  <!--form wysiwig js-->
  <script src="/admin_assets/plugins/tinymce/tinymce.min.js"></script>

  <script type="text/javascript" src="/admin_assets/plugins/jquery-quicksearch/jquery.quicksearch.js"></script>
  <script src="/admin_assets/plugins/select2/dist/js/select2.min.js" type="text/javascript"></script>
  <script type="text/javascript">
    $(".select2").select2();
    $(".select2-limiting").select2({
          maximumSelectionLength: 2
        });
  </script>
    <script type="text/javascript">
          $(document).ready(function () {
                    tinymce.init({
                        selector: "textarea#product_long_desc,textarea#bazarDetails",
                        theme: "modern",
                        height:100,
                        plugins: [
                            "advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker",
                            "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking",
                            "save table contextmenu directionality emoticons template paste textcolor"
                        ],
                        toolbar: "styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent",
                        style_formats: [
                            {title: 'Bold text', inline: 'b'},
                            {title: 'Red text', inline: 'span', styles: {color: '#ff0000'}},
                            {title: 'Red header', block: 'h1', styles: {color: '#ff0000'}},
                            {title: 'Example 1', inline: 'span', classes: 'example1'},
                            {title: 'Example 2', inline: 'span', classes: 'example2'},
                            {title: 'Table styles'},
                            {title: 'Table row 1', selector: 'tr', classes: 'tablerow1'}
                        ]
                    });
            });
  </script>
  <script>
    var allMonthReport = [];
    $(function () {
        // sortable
        $(".sortable").sortable({
            connectWith: '.sortable',
            items: '.card-draggable',
            revert: true,
            placeholder: 'card-draggable-placeholder',
            forcePlaceholderSize: true,
            opacity: 0.77,
            cursor: 'move'
        });

        $.ajax({
            type: "POST",
            url: '/findAllMonthReport',
            data: '',
            success: function(res) {
                if(res.msg == 'success'){
                  $.each(res.data,function(k,v){
                    var design = '<option value="'+v.month_id+'"><a href="/monthly-calculation/'+v.month_id+'">'+moment(v.month+' '+v.year,'MM YYYY').format('MMMM YYYY')+'</a></option>';
                    $('#changeMonthSelect').append(design);
                    
                  })
                }
            },
            error: function() {
                console.log('failed');
            }
        });
    });
    
    function toggleMsgBar(type){
        var wid = $('.side-bar.right-bar').width();
        console.log(wid);

        socket.emit('getMessUsers',{mess_id:mess_id},function(res){
            $('#convAllUserList').html('');
            $.each(res.data,function(k,v){
                if(user_id !== v.user_id)
                    $('#convAllUserList').append(conv_listDesign(v));
            });
            $('#msgContainer').hide();
            $('#convAllUserList').show();
            $('#Conv_list_label').show();
            if(type == 'open'){
                $('.side-bar.right-bar').css('right','0px');
                $('html').css('overflow','hidden');
            }else{
                $('.side-bar.right-bar').css('right','-400px');
                $('html').css('overflow','auto');
            }
        })
        
    }

    function conv_listDesign(data){
        var html = '<li class="list-group-item" onclick="startConversation(this)" user-id="'+data.user_id+'" user-name="'+data.user_name+'" user-img="'+data.user_img+'">';
            html +=     '<a href="javascript:void(0);" class="user-list-item">';
            html +=         '<div class="avatar" style="width:30px;height:30px;">';
            html +=             '<img style="width:100%;height:100%;" src="/admin_assets/images/users/'+data.user_img+'" alt="">';
            html +=             '<div class="user-activity-status user-status  '+((onlineUserList.indexOf(data.user_id) > -1 )? 'online':'offline') +' user_activity_'+data.user_id+'"><i class="zmdi zmdi-dot-circle"></i></div>';
            html +=         '</div>';
            html +=         '<div class="user-desc">';
            html +=             '<span class="name">'+data.user_name+'</span>';
            html +=             '<span class="desc">'+((data.user_role == 1)? 'Manageer':'Member')+'</span>';
            html +=         '</div>';
            html +=     '</a>';
            html +='</li>';

            return html;
    }
    function hideMsgContainer(){
      $('#msgContainer').hide();
      $('#convAllUserList').show();
      $('#Conv_list_label').show();
    }
    var activeConversation_id = '';
    function startConversation(ele){
        var data_user = $(ele).attr('user-id');
        var data_name = $(ele).attr('user-name');
        var data_img = $(ele).attr('user-img');
        if(data_user !== ''){
            var data = {
                participants:[user_id,data_user],
                mess_id :mess_id,
                conv_type:'personal',
                created_by:user_id
            }
            socket.emit('findConv_and_Messages',data,function(res){
                if(res.msg == 'success'){
                    $('#userHeadLabelimg').attr('src','/admin_assets/images/users/'+data_img+'');
                    $('#userHeadLabelName').text(data_name);
                    $('#userHeadLabelActivity').attr('class', '');
                    $('#userHeadLabelActivity').attr('class', 'font-13 text-muted m-b-0 '+((onlineUserList.indexOf(data_user) > -1 )? 'online':'offline') +' user_activity_'+data_user+'');
                    $('#sendMsgUserImg').attr('src','/admin_assets/images/users/'+data_img+'');
                    $('#sendMsgUserImg').attr('user-id',data_user);
                    $('#msgBodyContainer').html('');
                    $('#msgBodyContainer').attr('data-conv-id', res.conv_data.conversation_id);
                    $('#userHeadLabelimg').attr('data-img', data_img)
                    $('#msgBox').attr('data-conv-id', res.conv_data.conversation_id);
                    activeConversation_id = res.conv_data.conversation_id;
                    if(res.messages !== null){

                        $.each(res.messages, function(k,v){
                            $('#msgBodyContainer').append(drawMsg(v));
                        });
                    }
                    
                    $('#convAllUserList').hide();
                    $('#msgContainer').show();
                    $('#msgBox').focus();
                    $('#Conv_list_label').hide();
                    var scrollHeight = $('#msgBodyContainer').get(0).scrollHeight;
                    $('#msgBodyContainer').animate({ scrollTop: scrollHeight });
                }
            })
            
        }
    }

    function sendMsg(ele){
        var msg_body = $('#msgBox').html();
        var conv_id =  $('#msgBodyContainer').attr('data-conv-id');
        $('#msgBox').html("")

        var data = {
            msg_body:msg_body,
            conversation_id:activeConversation_id,
            sender_id:user_id,
            mess_id:mess_id,
            receiver_id: $('#sendMsgUserImg').attr('user-id'),
            sender_img:user_img,
            sender_name:user_name
        }
        socket.emit('sendNewMsg',data,function(res){
            if(res.msg == 'success')
                $('#msgBodyContainer').append(drawMsg(res.data));

                var scrollHeight = $('#msgBodyContainer').get(0).scrollHeight;
                $('#msgBodyContainer').animate({ scrollTop: scrollHeight });
        });
    }

    function drawMsg(msg){
        var html = '';
            html += '<div class="media m-b-5 m-t-5 '+((msg.sender_id == user_id)? 'right_user':'left_user')+'">';
            if(msg.sender_id !== user_id){

                html +=     '<div class=" '+((msg.sender_id == user_id)? 'media-right':'media-left')+'">';
                html +=         '<a href="#"> <img class="media-object img-circle thumb-sm user_img" alt="30x30" src="/admin_assets/images/users/'+((msg.sender_id == user_id)? user_img:$('#userHeadLabelimg').attr('data-img'))+'"> </a>';
                html +=     '</div>';
            }
            html +=     '<div class="media-body">';
            html +=         '<p class="font-13 text-muted m-b-0 '+((msg.sender_id == user_id)? 'msg_body_right':'msg_body_left')+'">'+msg.msg_body+'</p>';
            html +=     '</div>';
            html += '</div>';
        
            return html;                    
                            
    }

    function msgBoxKeyup(e,ele){
        var keyCode = 'which' in e ? e.which : e.keyCode;
        if(e.shiftKey && keyCode == 13){
            
        }else if(keyCode == 13){
            e.preventDefault();
            e.stopImmediatePropagation();
            $('#msgSendBtn').trigger('click');

        }
    }
    function msgboxkeydown(e,ele){
        var keyCode = 'which' in e ? e.which : e.keyCode;
        if(e.shiftKey && keyCode == 13){
           
        }else if(keyCode == 13){
            e.preventDefault();
            e.stopImmediatePropagation();

        }
    }

    socket.on('newMessage',function(message){
        if(message.sender_info.receiver_id == user_id){
            if($('#msgContainer').is(':visible')){
                if(activeConversation_id == message.sender_info.conversation_id){
                    if(message.msg == 'success')
                        $('#msgBodyContainer').append(drawMsg(message.data));

                        var scrollHeight = $('#msgBodyContainer').get(0).scrollHeight;
                        $('#msgBodyContainer').animate({ scrollTop: scrollHeight });
                }
            }
        }
    });



        $(window).load(function() {
        	// Animate loader off screen
            $("#pageLoader").fadeOut("slow");
            socket.emit('getUnreadMsg', {mess_id:mess_id,user_id:user_id},function(res){
                if(res.msg == 'success'){
                    $('#allunreadMsgCount').text(res.count);
                    console.log(res)
                }
            })
        });




</script>


</body>
</html>
